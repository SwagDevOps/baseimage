#!/usr/bin/env ruby
# frozen_string_literal: true

# This script installs gems with options from ``../config/gems.yml``
#
# located in ``BUILD_VENDOR_DIR`` directory.

require 'build'
require 'yaml'
require 'pathname'

Pathname.new(__dir__).join('../config/gems.yml').tap do |fp|
  YAML.safe_load(fp.read).each do |name, options|
    ENV.fetch('BUILD_VENDOR_DIR').tap do |dir|
      options = Hash[options.map { |(k, v)| [k.to_sym, v] }]

      (options[:local] ? "#{dir}/#{name}" : name)
        .tap { |gem| Build::Gem.install(gem, options) }
    end
  end
end
